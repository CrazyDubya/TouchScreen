<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Photo Gallery - TouchScreen Demo</title>
  <link rel="stylesheet" href="../../css/main.css">
  <link rel="stylesheet" href="../../css/components.css">
  <style>
    .gallery-container {
      background: var(--gray-900);
      min-height: 80vh;
      border-radius: var(--radius-lg);
      overflow: hidden;
      position: relative;
    }

    .gallery-main {
      position: relative;
      height: 600px;
      background: black;
      overflow: hidden;
      touch-action: none;
    }

    .gallery-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      position: absolute;
      top: 0;
      left: 0;
      transition: opacity 0.3s;
      user-select: none;
    }

    .gallery-image.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .gallery-controls {
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      transform: translateY(-50%);
      display: flex;
      justify-content: space-between;
      padding: 0 var(--space-lg);
      pointer-events: none;
      z-index: 10;
    }

    .gallery-btn {
      background: rgba(255, 255, 255, 0.9);
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      cursor: pointer;
      pointer-events: all;
      transition: all var(--transition-fast);
      box-shadow: var(--shadow-lg);
    }

    .gallery-btn:hover {
      background: white;
      transform: scale(1.1);
    }

    .gallery-btn:active {
      transform: scale(0.95);
    }

    .gallery-info {
      position: absolute;
      top: var(--space-lg);
      left: var(--space-lg);
      right: var(--space-lg);
      color: white;
      background: rgba(0, 0, 0, 0.7);
      padding: var(--space-md);
      border-radius: var(--radius-md);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 10;
    }

    .gallery-counter {
      font-weight: 700;
    }

    .gallery-zoom-info {
      font-size: 0.875rem;
      opacity: 0.9;
    }

    .thumbnails {
      display: flex;
      gap: var(--space-sm);
      padding: var(--space-lg);
      overflow-x: auto;
      background: var(--gray-800);
    }

    .thumbnail {
      min-width: 80px;
      height: 80px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      border: 3px solid transparent;
      transition: all var(--transition-fast);
      object-fit: cover;
    }

    .thumbnail:hover {
      transform: scale(1.05);
    }

    .thumbnail.active {
      border-color: var(--primary);
      transform: scale(1.1);
    }

    .gesture-hint {
      position: absolute;
      bottom: var(--space-lg);
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: var(--space-md) var(--space-lg);
      border-radius: var(--radius-full);
      font-size: 0.875rem;
      z-index: 10;
      animation: fadeInOut 3s ease-in-out;
    }

    @keyframes fadeInOut {
      0%, 100% { opacity: 0; }
      20%, 80% { opacity: 1; }
    }

    .fullscreen-btn {
      background: rgba(255, 255, 255, 0.9);
      border: none;
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-md);
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .fullscreen-btn:hover {
      background: white;
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="header-content">
        <a href="../../index.html" class="logo">TouchScreen Demos</a>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="container">
      <a href="../../index.html" class="back-link">‚Üê Back to Home</a>

      <h1>Photo Gallery</h1>
      <p class="mb-lg" style="color: var(--gray-600); font-size: 1.125rem;">
        Swipe to navigate, pinch to zoom, double-tap to zoom in/out.
      </p>

      <div class="gallery-container">
        <div class="gallery-main" id="galleryMain">
          <div class="gallery-info">
            <span class="gallery-counter" id="counter">1 / 8</span>
            <span class="gallery-zoom-info" id="zoomInfo">100%</span>
            <button class="fullscreen-btn" onclick="toggleFullscreen()">‚õ∂ Fullscreen</button>
          </div>

          <img src="" alt="Gallery image" class="gallery-image" id="mainImage">

          <div class="gallery-controls">
            <button class="gallery-btn" onclick="previousImage()">‚Üê</button>
            <button class="gallery-btn" onclick="nextImage()">‚Üí</button>
          </div>

          <div class="gesture-hint" id="gestureHint">
            üëÜ Swipe left/right | ü§è Pinch to zoom | ‚úåÔ∏è Double-tap
          </div>
        </div>

        <div class="thumbnails" id="thumbnails"></div>
      </div>

      <!-- Demo Info -->
      <div class="demo-info mt-xl">
        <h3>Touch Gestures</h3>
        <ul style="margin-left: var(--space-lg);">
          <li><strong>Swipe left/right:</strong> Navigate between images</li>
          <li><strong>Pinch:</strong> Zoom in and out</li>
          <li><strong>Double-tap:</strong> Quick zoom toggle</li>
          <li><strong>Pan:</strong> Move zoomed image (when zoomed in)</li>
          <li><strong>Keyboard:</strong> Arrow keys also work!</li>
        </ul>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <p>TouchScreen Demo Showcase v0.1 - Photo Gallery</p>
    </div>
  </footer>

  <script src="../../js/touch-utils.js"></script>
  <script>
    // Gallery images (using placeholder service)
    const images = [
      { src: 'https://picsum.photos/800/600?random=1', title: 'Landscape 1' },
      { src: 'https://picsum.photos/800/600?random=2', title: 'Landscape 2' },
      { src: 'https://picsum.photos/800/600?random=3', title: 'Landscape 3' },
      { src: 'https://picsum.photos/800/600?random=4', title: 'Landscape 4' },
      { src: 'https://picsum.photos/800/600?random=5', title: 'Landscape 5' },
      { src: 'https://picsum.photos/800/600?random=6', title: 'Landscape 6' },
      { src: 'https://picsum.photos/800/600?random=7', title: 'Landscape 7' },
      { src: 'https://picsum.photos/800/600?random=8', title: 'Landscape 8' }
    ];

    let currentIndex = 0;
    let currentZoom = 1;
    let currentPan = { x: 0, y: 0 };
    let initialPinchDistance = 0;
    let initialZoom = 1;

    const mainImage = document.getElementById('mainImage');
    const galleryMain = document.getElementById('galleryMain');
    const counter = document.getElementById('counter');
    const zoomInfo = document.getElementById('zoomInfo');
    const thumbnailsContainer = document.getElementById('thumbnails');

    // Initialize gallery
    function init() {
      // Load thumbnails
      images.forEach((img, index) => {
        const thumb = document.createElement('img');
        thumb.src = img.src;
        thumb.className = 'thumbnail';
        if (index === 0) thumb.classList.add('active');
        thumb.onclick = () => goToImage(index);
        thumbnailsContainer.appendChild(thumb);
      });

      // Load first image
      loadImage(0);

      // Hide gesture hint after 3 seconds
      setTimeout(() => {
        document.getElementById('gestureHint').style.display = 'none';
      }, 3000);
    }

    function loadImage(index) {
      currentIndex = index;
      mainImage.src = images[index].src;
      counter.textContent = `${index + 1} / ${images.length}`;

      // Reset zoom and pan
      currentZoom = 1;
      currentPan = { x: 0, y: 0 };
      updateImageTransform();

      // Update active thumbnail
      document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
        thumb.classList.toggle('active', i === index);
      });
    }

    function updateImageTransform() {
      mainImage.style.transform = `scale(${currentZoom}) translate(${currentPan.x}px, ${currentPan.y}px)`;
      zoomInfo.textContent = `${Math.round(currentZoom * 100)}%`;
    }

    function nextImage() {
      const newIndex = (currentIndex + 1) % images.length;
      loadImage(newIndex);
      TouchUtils.vibrate(10);
    }

    function previousImage() {
      const newIndex = (currentIndex - 1 + images.length) % images.length;
      loadImage(newIndex);
      TouchUtils.vibrate(10);
    }

    function goToImage(index) {
      loadImage(index);
      TouchUtils.vibrate(10);
    }

    // Swipe Detection
    TouchUtils.initSwipe(galleryMain, {
      onSwipeLeft: () => {
        if (currentZoom === 1) nextImage();
      },
      onSwipeRight: () => {
        if (currentZoom === 1) previousImage();
      }
    });

    // Double Tap to Zoom
    TouchUtils.detectDoubleTap(mainImage, (e) => {
      if (currentZoom === 1) {
        currentZoom = 2;
        TouchUtils.vibrate([20, 50, 20]);
      } else {
        currentZoom = 1;
        currentPan = { x: 0, y: 0 };
        TouchUtils.vibrate(20);
      }
      updateImageTransform();
    });

    // Pinch Zoom
    let pinching = false;

    galleryMain.addEventListener('touchstart', (e) => {
      if (e.touches.length === 2) {
        pinching = true;
        initialPinchDistance = TouchUtils.getPinchDistance(e.touches);
        initialZoom = currentZoom;
      }
    });

    galleryMain.addEventListener('touchmove', (e) => {
      if (pinching && e.touches.length === 2) {
        e.preventDefault();
        const currentDistance = TouchUtils.getPinchDistance(e.touches);
        const scale = currentDistance / initialPinchDistance;
        currentZoom = Math.max(0.5, Math.min(4, initialZoom * scale));
        updateImageTransform();
      } else if (currentZoom > 1 && e.touches.length === 1) {
        // Pan when zoomed
        e.preventDefault();
        const touch = e.touches[0];
        const rect = galleryMain.getBoundingClientRect();
        const x = (touch.clientX - rect.left - rect.width / 2) / currentZoom;
        const y = (touch.clientY - rect.top - rect.height / 2) / currentZoom;
        currentPan = { x, y };
        updateImageTransform();
      }
    });

    galleryMain.addEventListener('touchend', (e) => {
      if (e.touches.length < 2) {
        pinching = false;
      }
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      switch(e.key) {
        case 'ArrowLeft':
          previousImage();
          break;
        case 'ArrowRight':
          nextImage();
          break;
        case '+':
        case '=':
          currentZoom = Math.min(4, currentZoom + 0.2);
          updateImageTransform();
          break;
        case '-':
        case '_':
          currentZoom = Math.max(0.5, currentZoom - 0.2);
          updateImageTransform();
          break;
        case '0':
          currentZoom = 1;
          currentPan = { x: 0, y: 0 };
          updateImageTransform();
          break;
      }
    });

    // Fullscreen
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        galleryMain.requestFullscreen().catch(err => {
          console.log('Fullscreen error:', err);
        });
      } else {
        document.exitFullscreen();
      }
      TouchUtils.vibrate(10);
    }

    // Initialize
    init();
  </script>
</body>
</html>
