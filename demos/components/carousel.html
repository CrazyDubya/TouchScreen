<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Momentum Carousel - TouchScreen Demo</title>
  <link rel="stylesheet" href="../../css/main.css">
  <link rel="stylesheet" href="../../css/components.css">
  <style>
    .carousel-section {
      background: white;
      padding: var(--space-xl);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-xl);
      margin: var(--space-xl) 0;
      overflow: hidden;
    }

    .carousel-viewport {
      overflow: hidden;
      position: relative;
      border-radius: var(--radius-lg);
    }

    .carousel-track {
      display: flex;
      touch-action: pan-y;
      cursor: grab;
      user-select: none;
      transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .carousel-track.dragging {
      transition: none;
      cursor: grabbing;
    }

    .carousel-track.momentum {
      transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .carousel-slide {
      flex: 0 0 100%;
      padding: var(--space-md);
    }

    .slide-content {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: var(--radius-lg);
      padding: var(--space-2xl);
      min-height: 300px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      text-align: center;
    }

    .slide-icon {
      font-size: 4rem;
      margin-bottom: var(--space-lg);
    }

    .slide-title {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: var(--space-md);
    }

    .slide-description {
      font-size: 1.125rem;
      opacity: 0.9;
      max-width: 400px;
    }

    .carousel-indicators {
      display: flex;
      justify-content: center;
      gap: var(--space-sm);
      margin-top: var(--space-lg);
    }

    .indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--gray-300);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .indicator:hover {
      background: var(--gray-400);
      transform: scale(1.2);
    }

    .indicator.active {
      background: var(--primary);
      transform: scale(1.3);
    }

    .carousel-nav {
      display: flex;
      justify-content: space-between;
      margin-top: var(--space-lg);
    }

    .nav-btn {
      background: var(--gray-100);
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .nav-btn:hover {
      background: var(--primary);
      color: white;
      transform: scale(1.1);
    }

    .nav-btn:active {
      transform: scale(0.95);
    }

    .nav-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .carousel-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-md);
      background: var(--gray-100);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-lg);
      font-size: 0.875rem;
      color: var(--gray-700);
    }

    .velocity-meter {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .velocity-bar {
      width: 100px;
      height: 8px;
      background: var(--gray-300);
      border-radius: var(--radius-full);
      overflow: hidden;
    }

    .velocity-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--success), var(--warning), var(--danger));
      width: 0%;
      transition: width 0.1s;
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="header-content">
        <a href="../../index.html" class="logo">TouchScreen Demos</a>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="container">
      <a href="../../index.html" class="back-link">‚Üê Back to Home</a>

      <h1>Momentum Carousel</h1>
      <p class="mb-lg" style="color: var(--gray-600); font-size: 1.125rem;">
        Swipeable carousel with momentum-based scrolling and smooth animations.
      </p>

      <div class="carousel-section">
        <div class="carousel-info">
          <span>Slide <strong id="currentSlide">1</strong> of <strong id="totalSlides">6</strong></span>
          <div class="velocity-meter">
            <span>Velocity:</span>
            <div class="velocity-bar">
              <div class="velocity-fill" id="velocityFill"></div>
            </div>
          </div>
        </div>

        <div class="carousel-viewport">
          <div class="carousel-track" id="carouselTrack">
            <div class="carousel-slide">
              <div class="slide-content" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                <div class="slide-icon">üöÄ</div>
                <div class="slide-title">Fast & Smooth</div>
                <div class="slide-description">
                  Experience buttery smooth momentum-based scrolling
                </div>
              </div>
            </div>

            <div class="carousel-slide">
              <div class="slide-content" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                <div class="slide-icon">üëÜ</div>
                <div class="slide-title">Touch Optimized</div>
                <div class="slide-description">
                  Designed for touch with natural gesture recognition
                </div>
              </div>
            </div>

            <div class="carousel-slide">
              <div class="slide-content" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                <div class="slide-icon">‚ö°</div>
                <div class="slide-title">Velocity Tracking</div>
                <div class="slide-description">
                  Swipe speed affects momentum and distance traveled
                </div>
              </div>
            </div>

            <div class="carousel-slide">
              <div class="slide-content" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
                <div class="slide-icon">üéØ</div>
                <div class="slide-title">Snap to Slides</div>
                <div class="slide-description">
                  Automatically snaps to the nearest slide
                </div>
              </div>
            </div>

            <div class="carousel-slide">
              <div class="slide-content" style="background: linear-gradient(135deg, #fa709a, #fee140);">
                <div class="slide-icon">üì±</div>
                <div class="slide-title">Mobile First</div>
                <div class="slide-description">
                  Built for mobile but works great on desktop too
                </div>
              </div>
            </div>

            <div class="carousel-slide">
              <div class="slide-content" style="background: linear-gradient(135deg, #30cfd0, #330867);">
                <div class="slide-icon">üé®</div>
                <div class="slide-title">Customizable</div>
                <div class="slide-description">
                  Easy to customize and adapt to your needs
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="carousel-indicators" id="indicators"></div>

        <div class="carousel-nav">
          <button class="nav-btn" id="prevBtn" onclick="goToPrev()">‚Üê</button>
          <button class="btn btn-secondary" onclick="autoPlay()">
            <span id="playIcon">‚ñ∂Ô∏è</span> <span id="playText">Auto Play</span>
          </button>
          <button class="nav-btn" id="nextBtn" onclick="goToNext()">‚Üí</button>
        </div>
      </div>

      <!-- Demo Info -->
      <div class="demo-info">
        <h3>Features</h3>
        <ul style="margin-left: var(--space-lg);">
          <li><strong>Momentum Scrolling:</strong> Swipe with different speeds for varying momentum</li>
          <li><strong>Velocity Tracking:</strong> Real-time velocity visualization</li>
          <li><strong>Snap to Slide:</strong> Automatically centers on nearest slide</li>
          <li><strong>Touch & Mouse:</strong> Works with both touch and mouse input</li>
          <li><strong>Navigation:</strong> Swipe, click indicators, or use arrow buttons</li>
          <li><strong>Auto Play:</strong> Optional automatic slide progression</li>
        </ul>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <p>TouchScreen Demo Showcase v0.2 - Momentum Carousel</p>
    </div>
  </footer>

  <script src="../../js/touch-utils.js"></script>
  <script>
    const track = document.getElementById('carouselTrack');
    const indicators = document.getElementById('indicators');
    const velocityFill = document.getElementById('velocityFill');

    let currentIndex = 0;
    const totalSlides = track.children.length;
    let isDragging = false;
    let startX = 0;
    let currentTranslate = 0;
    let prevTranslate = 0;
    let animationID;
    let startTime = 0;
    let velocity = 0;
    let autoPlayInterval;

    // Initialize
    document.getElementById('totalSlides').textContent = totalSlides;
    createIndicators();
    updateCarousel();

    function createIndicators() {
      for (let i = 0; i < totalSlides; i++) {
        const indicator = document.createElement('div');
        indicator.className = 'indicator';
        if (i === 0) indicator.classList.add('active');
        indicator.onclick = () => goToSlide(i);
        indicators.appendChild(indicator);
      }
    }

    function getPositionX(e) {
      return e.type.includes('mouse') ? e.pageX : e.touches[0].clientX;
    }

    function touchStart(e) {
      isDragging = true;
      startX = getPositionX(e);
      startTime = Date.now();
      velocity = 0;

      track.classList.add('dragging');
      track.classList.remove('momentum');

      animationID = requestAnimationFrame(animation);
      TouchUtils.vibrate(5);
    }

    function touchMove(e) {
      if (!isDragging) return;

      const currentPosition = getPositionX(e);
      const diff = currentPosition - startX;
      currentTranslate = prevTranslate + diff;

      // Calculate velocity
      const currentTime = Date.now();
      const timeDiff = currentTime - startTime;
      if (timeDiff > 0) {
        velocity = Math.abs(diff / timeDiff);
        updateVelocityMeter(velocity);
      }
    }

    function touchEnd() {
      if (!isDragging) return;

      isDragging = false;
      track.classList.remove('dragging');

      const movedBy = currentTranslate - prevTranslate;

      // Determine snap position based on movement and velocity
      if (Math.abs(movedBy) > 50 || velocity > 0.3) {
        if (movedBy < 0 && currentIndex < totalSlides - 1) {
          currentIndex++;
        } else if (movedBy > 0 && currentIndex > 0) {
          currentIndex--;
        }
      }

      // Apply momentum if velocity is high
      if (velocity > 0.5 && Math.abs(movedBy) > 50) {
        track.classList.add('momentum');
        const momentumSlides = Math.floor(velocity * 2);

        if (movedBy < 0) {
          currentIndex = Math.min(currentIndex + momentumSlides, totalSlides - 1);
        } else {
          currentIndex = Math.max(currentIndex - momentumSlides, 0);
        }
      }

      setPositionByIndex();
      cancelAnimationFrame(animationID);

      setTimeout(() => {
        velocity = 0;
        updateVelocityMeter(0);
      }, 300);
    }

    function animation() {
      setSliderPosition();
      if (isDragging) requestAnimationFrame(animation);
    }

    function setSliderPosition() {
      track.style.transform = `translateX(${currentTranslate}px)`;
    }

    function setPositionByIndex() {
      currentTranslate = currentIndex * -window.innerWidth;
      prevTranslate = currentTranslate;
      setSliderPosition();
      updateCarousel();
      TouchUtils.vibrate(10);
    }

    function updateCarousel() {
      document.getElementById('currentSlide').textContent = currentIndex + 1;

      // Update indicators
      const indicatorDots = indicators.children;
      for (let i = 0; i < indicatorDots.length; i++) {
        indicatorDots[i].classList.toggle('active', i === currentIndex);
      }

      // Update nav buttons
      document.getElementById('prevBtn').disabled = currentIndex === 0;
      document.getElementById('nextBtn').disabled = currentIndex === totalSlides - 1;
    }

    function updateVelocityMeter(vel) {
      const percentage = Math.min(vel * 100, 100);
      velocityFill.style.width = percentage + '%';
    }

    function goToSlide(index) {
      currentIndex = index;
      setPositionByIndex();
    }

    function goToPrev() {
      if (currentIndex > 0) {
        currentIndex--;
        setPositionByIndex();
      }
    }

    function goToNext() {
      if (currentIndex < totalSlides - 1) {
        currentIndex++;
        setPositionByIndex();
      }
    }

    function autoPlay() {
      const playIcon = document.getElementById('playIcon');
      const playText = document.getElementById('playText');

      if (autoPlayInterval) {
        clearInterval(autoPlayInterval);
        autoPlayInterval = null;
        playIcon.textContent = '‚ñ∂Ô∏è';
        playText.textContent = 'Auto Play';
      } else {
        autoPlayInterval = setInterval(() => {
          if (currentIndex < totalSlides - 1) {
            goToNext();
          } else {
            currentIndex = 0;
            setPositionByIndex();
          }
        }, 3000);
        playIcon.textContent = '‚è∏Ô∏è';
        playText.textContent = 'Pause';
      }

      TouchUtils.vibrate(10);
    }

    // Event listeners
    track.addEventListener('touchstart', touchStart);
    track.addEventListener('touchmove', touchMove);
    track.addEventListener('touchend', touchEnd);

    track.addEventListener('mousedown', touchStart);
    track.addEventListener('mousemove', touchMove);
    track.addEventListener('mouseup', touchEnd);
    track.addEventListener('mouseleave', () => {
      if (isDragging) touchEnd();
    });

    // Prevent context menu
    track.addEventListener('contextmenu', e => e.preventDefault());

    // Handle window resize
    window.addEventListener('resize', () => {
      setPositionByIndex();
    });

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (autoPlayInterval) clearInterval(autoPlayInterval);
    });
  </script>
</body>
</html>
