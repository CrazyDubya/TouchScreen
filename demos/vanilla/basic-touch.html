<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Basic Touch Events - TouchScreen Demo</title>
  <link rel="stylesheet" href="../../css/main.css">
  <link rel="stylesheet" href="../../css/components.css">
  <style>
    .touch-area {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: var(--radius-lg);
      min-height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
      font-weight: 700;
      position: relative;
      overflow: hidden;
      touch-action: none;
      user-select: none;
    }

    .touch-point {
      position: absolute;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid white;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .touch-point.active {
      background: rgba(255, 255, 255, 0.5);
      animation: pulse 0.5s ease-out;
    }

    @keyframes pulse {
      0% { transform: translate(-50%, -50%) scale(1); }
      50% { transform: translate(-50%, -50%) scale(1.2); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }

    .touch-info {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: var(--space-md);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
      font-weight: 400;
      max-width: 300px;
    }

    .event-log {
      background: var(--gray-900);
      color: var(--success);
      padding: var(--space-lg);
      border-radius: var(--radius-md);
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.875rem;
      max-height: 300px;
      overflow-y: auto;
      margin-top: var(--space-lg);
    }

    .event-log-item {
      padding: var(--space-xs) 0;
      border-bottom: 1px solid rgba(16, 185, 129, 0.2);
    }

    .event-log-item:last-child {
      border-bottom: none;
    }

    .stat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: var(--space-md);
      margin: var(--space-lg) 0;
    }

    .stat-card {
      background: white;
      padding: var(--space-md);
      border-radius: var(--radius-md);
      border-left: 4px solid var(--primary);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
    }

    .stat-label {
      font-size: 0.875rem;
      color: var(--gray-600);
      margin-top: var(--space-xs);
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="header-content">
        <a href="../../index.html" class="logo">TouchScreen Demos</a>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="container">
      <a href="../../index.html" class="back-link">← Back to Home</a>

      <h1>Basic Touch Events</h1>
      <p class="mb-lg" style="color: var(--gray-600); font-size: 1.125rem;">
        Explore fundamental touch events: touchstart, touchmove, touchend, and multi-touch detection.
      </p>

      <!-- Touch Area -->
      <div class="demo-area">
        <div id="touchArea" class="touch-area">
          <div class="touch-info">
            <strong>Try it:</strong><br>
            • Single touch<br>
            • Multi-touch<br>
            • Drag across screen<br>
            • Touch with multiple fingers
          </div>
          <span id="touchMessage">Touch or click here!</span>
        </div>
      </div>

      <!-- Statistics -->
      <div class="stat-grid">
        <div class="stat-card">
          <div class="stat-value" id="touchCount">0</div>
          <div class="stat-label">Total Touches</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="activeTouches">0</div>
          <div class="stat-label">Active Touches</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="maxTouches">0</div>
          <div class="stat-label">Max Simultaneous</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="eventCount">0</div>
          <div class="stat-label">Total Events</div>
        </div>
      </div>

      <!-- Event Log -->
      <div class="demo-controls">
        <button class="btn btn-primary" onclick="clearLog()">Clear Log</button>
        <button class="btn btn-secondary" onclick="resetStats()">Reset Stats</button>
      </div>

      <div id="eventLog" class="event-log">
        <div class="event-log-item">Event log initialized. Start touching!</div>
      </div>

      <!-- Documentation -->
      <div class="demo-info mt-xl">
        <h3>How It Works</h3>
        <p>
          This demo uses three main touch events:
        </p>
        <ul style="margin-left: var(--space-lg); margin-top: var(--space-md);">
          <li><strong>touchstart:</strong> Fired when a finger touches the screen</li>
          <li><strong>touchmove:</strong> Fired when a finger moves across the screen</li>
          <li><strong>touchend:</strong> Fired when a finger is lifted from the screen</li>
        </ul>
        <p style="margin-top: var(--space-md);">
          Each event provides a <code>touches</code> array containing information about all active touch points,
          enabling multi-touch detection and complex gesture recognition.
        </p>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <p>TouchScreen Demo Showcase v0.1 - Basic Touch Events</p>
    </div>
  </footer>

  <script src="../../js/touch-utils.js"></script>
  <script>
    const touchArea = document.getElementById('touchArea');
    const touchMessage = document.getElementById('touchMessage');
    const eventLog = document.getElementById('eventLog');

    // Statistics
    let stats = {
      touchCount: 0,
      eventCount: 0,
      maxTouches: 0,
      activeTouches: 0
    };

    // Track touch points
    const touchPoints = new Map();

    function updateStats() {
      document.getElementById('touchCount').textContent = stats.touchCount;
      document.getElementById('activeTouches').textContent = stats.activeTouches;
      document.getElementById('maxTouches').textContent = stats.maxTouches;
      document.getElementById('eventCount').textContent = stats.eventCount;
    }

    function logEvent(eventType, details = '') {
      stats.eventCount++;
      const timestamp = new Date().toLocaleTimeString();
      const logItem = document.createElement('div');
      logItem.className = 'event-log-item';
      logItem.textContent = `[${timestamp}] ${eventType} ${details}`;
      eventLog.insertBefore(logItem, eventLog.firstChild);

      // Keep only last 50 events
      while (eventLog.children.length > 50) {
        eventLog.removeChild(eventLog.lastChild);
      }

      updateStats();
    }

    function createTouchPoint(id, x, y) {
      const point = document.createElement('div');
      point.className = 'touch-point active';
      point.style.left = `${x}px`;
      point.style.top = `${y}px`;
      point.dataset.touchId = id;
      touchArea.appendChild(point);
      touchPoints.set(id, point);
      return point;
    }

    function updateTouchPoint(id, x, y) {
      const point = touchPoints.get(id);
      if (point) {
        point.style.left = `${x}px`;
        point.style.top = `${y}px`;
      }
    }

    function removeTouchPoint(id) {
      const point = touchPoints.get(id);
      if (point) {
        point.style.opacity = '0';
        setTimeout(() => point.remove(), 300);
        touchPoints.delete(id);
      }
    }

    // Touch Event Handlers
    touchArea.addEventListener('touchstart', (e) => {
      e.preventDefault();
      const touches = Array.from(e.touches);

      stats.touchCount++;
      stats.activeTouches = touches.length;
      stats.maxTouches = Math.max(stats.maxTouches, touches.length);

      touches.forEach((touch) => {
        const rect = touchArea.getBoundingClientRect();
        const x = touch.clientX - rect.left;
        const y = touch.clientY - rect.top;

        if (!touchPoints.has(touch.identifier)) {
          createTouchPoint(touch.identifier, x, y);
        }
      });

      touchMessage.textContent = `${touches.length} touch${touches.length > 1 ? 'es' : ''} active`;
      logEvent('touchstart', `- ${touches.length} touch point(s)`);
    });

    touchArea.addEventListener('touchmove', (e) => {
      e.preventDefault();
      const touches = Array.from(e.touches);

      touches.forEach((touch) => {
        const rect = touchArea.getBoundingClientRect();
        const x = touch.clientX - rect.left;
        const y = touch.clientY - rect.top;
        updateTouchPoint(touch.identifier, x, y);
      });

      if (stats.eventCount % 10 === 0) { // Log every 10th move event to avoid spam
        logEvent('touchmove', `- tracking ${touches.length} point(s)`);
      }
    });

    touchArea.addEventListener('touchend', (e) => {
      e.preventDefault();
      const changedTouches = Array.from(e.changedTouches);

      changedTouches.forEach((touch) => {
        removeTouchPoint(touch.identifier);
      });

      stats.activeTouches = e.touches.length;

      if (e.touches.length === 0) {
        touchMessage.textContent = 'Touch or click here!';
      } else {
        touchMessage.textContent = `${e.touches.length} touch${e.touches.length > 1 ? 'es' : ''} active`;
      }

      logEvent('touchend', `- ${changedTouches.length} touch point(s) released`);
    });

    // Mouse events for desktop testing
    let mouseDown = false;
    touchArea.addEventListener('mousedown', (e) => {
      mouseDown = true;
      const rect = touchArea.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      createTouchPoint('mouse', x, y);
      touchMessage.textContent = 'Mouse active (simulated touch)';
      logEvent('mousedown', '- mouse press detected');
      stats.touchCount++;
      stats.activeTouches = 1;
      updateStats();
    });

    touchArea.addEventListener('mousemove', (e) => {
      if (!mouseDown) return;

      const rect = touchArea.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      updateTouchPoint('mouse', x, y);
    });

    touchArea.addEventListener('mouseup', (e) => {
      if (!mouseDown) return;
      mouseDown = false;

      removeTouchPoint('mouse');
      touchMessage.textContent = 'Touch or click here!';
      logEvent('mouseup', '- mouse released');
      stats.activeTouches = 0;
      updateStats();
    });

    touchArea.addEventListener('mouseleave', (e) => {
      if (mouseDown) {
        mouseDown = false;
        removeTouchPoint('mouse');
        touchMessage.textContent = 'Touch or click here!';
        stats.activeTouches = 0;
        updateStats();
      }
    });

    // Utility Functions
    function clearLog() {
      eventLog.innerHTML = '<div class="event-log-item">Event log cleared.</div>';
    }

    function resetStats() {
      stats = {
        touchCount: 0,
        eventCount: 0,
        maxTouches: 0,
        activeTouches: 0
      };
      updateStats();
      touchPoints.forEach((point, id) => removeTouchPoint(id));
      touchMessage.textContent = 'Touch or click here!';
      logEvent('RESET', '- all statistics cleared');
    }

    // Initialize
    updateStats();
  </script>
</body>
</html>
